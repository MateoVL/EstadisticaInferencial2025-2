mutate(
extremo = factor(if_else(abs(dif_m) >= abs(dif_obs), 1, 0))
) |>
ggplot(aes(x = dif_m)) +
geom_histogram(
aes(alpha = extremo),
boundary = 0,
binwidth = ancho_barra_ajustado,
color = "steelblue4",
fill = "steelblue"
) +
labs(
title = titulo,
x = "Diferencia de dos medias",
y = "Frecuencia"
) +
geom_vline(
xintercept = c(-dif_obs, dif_obs),
colour = "steelblue4",
linetype = "dashed"
) +
annotate(
"text",
x = dif_obs,
y = Inf,
hjust = 1.2,
vjust = 2,
label = y27a,
parse = TRUE
) +
scale_alpha_manual(values = c("0" = 0.2, "1" = 1), guide = NULL) +
theme(plot.title = element_text(hjust = 0.5)) +
theme_pubr()
library(ggpubr)
titulo <- paste("Contraste de hipótesis usando", 1999, "permutaciones")
y27a <- if_else(
p_valor < 0.001,
glue("italic(p) ~ '<' ~ 0.001"),
glue("italic(p) == {sprintf('%.3f', p_valor)}")
)
ancho_barra <- diff(range(dist_perm[["dif_m"]])) /
nclass.scott(dist_perm[["dif_m"]])
ancho_barra_ajustado <- abs(dif_obs) /
max(1, round(abs(dif_obs) / ancho_barra))
dist_perm_pl <- dist_perm |>
mutate(
extremo = factor(if_else(abs(dif_m) >= abs(dif_obs), 1, 0))
) |>
ggplot(aes(x = dif_m)) +
geom_histogram(
aes(alpha = extremo),
boundary = 0,
binwidth = ancho_barra_ajustado,
color = "steelblue4",
fill = "steelblue"
) +
labs(
title = titulo,
x = "Diferencia de dos medias",
y = "Frecuencia"
) +
geom_vline(
xintercept = c(-dif_obs, dif_obs),
colour = "steelblue4",
linetype = "dashed"
) +
annotate(
"text",
x = dif_obs,
y = Inf,
hjust = 1.2,
vjust = 2,
label = y27a,
parse = TRUE
) +
scale_alpha_manual(values = c("0" = 0.2, "1" = 1), guide = NULL) +
theme(plot.title = element_text(hjust = 0.5)) +
theme_pubr()
print(dist_perm_pl)
library(ggplot2)
library(DT) #Para hacer tablas
library(plotly)
library(dplyr)
library(tibble)
library(purrr)
library(rsample)
library(glue)
library(tidyr)
library(ggpubr)
datos <- read.csv("EP08 Datos CASEN 2017.csv")
regiones_filtradas <- datos %>%
filter(region %in% c(
"Región Metropolitana de Santiago",
"Región de Tarapacá"
))
datosRelevantes <- data.frame(
id_vivienda = regiones_filtradas$id.vivienda,
y27a = regiones_filtradas$y27a,
e8 = regiones_filtradas$e8,
region = regiones_filtradas$region
)
datos_filtrados <- datosRelevantes %>%
filter(!is.na(e8), e8 != "N/A" | e8 != "No sabe/no responde")
set.seed(234)
muestra <- datos_filtrados[sample(nrow(datos_filtrados), 125, replace = FALSE),]
muestra_metropolitana <- muestra %>%
filter(region == "Región Metropolitana de Santiago")
muestra_tarapaca <- muestra %>%
filter(region == "Región de Tarapacá")
y27a_metropolitana <- muestra_metropolitana$y27a
y27a_tarapaca <- muestra_tarapaca$y27a
Muestra <- factor(c(rep("Metropolitana", length(y27a_metropolitana)), rep("Tarapacá", length(y27a_tarapaca))))
datos_largos <- tibble(Muestra, y27a = c(y27a_metropolitana, y27a_tarapaca))
datos_largos <- datos_largos |>
mutate(
y27a_bin = case_when(
y27a == "Si" ~ 1,
y27a == "No" ~ 0,
y27a == "No sabe/No responde" ~ 0,
TRUE ~ NA_real_
)
) |>
filter(!is.na(y27a_bin))
remuestras <- permutations(datos_largos, permute = y27a_bin, times = 5999, apparent=TRUE)
dif_dos_medias <- function(remuestra, ...) {
analysis(remuestra) |>
group_by(Muestra) |>
summarise(m = mean(y27a_bin)) |>
summarise(m[1] - m[2]) |>
pull()
}
dist_perm <- remuestras |> mutate(dif_m = map(splits, dif_dos_medias)) |> unnest( dif_m)
library(ggplot2)
library(DT) #Para hacer tablas
library(plotly)
library(dplyr)
library(tibble)
library(purrr)
library(rsample)
library(glue)
library(tidyr)
library(ggpubr)
datos <- read.csv("EP08 Datos CASEN 2017.csv")
regiones_filtradas <- datos %>%
filter(region %in% c(
"Región Metropolitana de Santiago",
"Región de Tarapacá"
))
datosRelevantes <- data.frame(
id_vivienda = regiones_filtradas$id.vivienda,
y27a = regiones_filtradas$y27a,
e8 = regiones_filtradas$e8,
region = regiones_filtradas$region
)
datos_filtrados <- datosRelevantes %>%
filter(!is.na(e8), e8 != "N/A" | e8 != "No sabe/no responde")
set.seed(234)
muestra <- datos_filtrados[sample(nrow(datos_filtrados), 125, replace = FALSE),]
muestra_metropolitana <- muestra %>%
filter(region == "Región Metropolitana de Santiago")
muestra_tarapaca <- muestra %>%
filter(region == "Región de Tarapacá")
y27a_metropolitana <- muestra_metropolitana$y27a
y27a_tarapaca <- muestra_tarapaca$y27a
Muestra <- factor(c(rep("Metropolitana", length(y27a_metropolitana)), rep("Tarapacá", length(y27a_tarapaca))))
datos_largos <- tibble(Muestra, y27a = c(y27a_metropolitana, y27a_tarapaca))
datos_largos <- datos_largos |>
mutate(
y27a_bin = case_when(
y27a == "Si" ~ 1,
y27a == "No" ~ 0,
y27a == "No sabe/No responde" ~ 0,
TRUE ~ NA_real_
)
) |>
filter(!is.na(y27a_bin))
R = 5999
remuestras <- permutations(datos_largos, permute = y27a_bin, times = R, apparent=TRUE)
dif_dos_medias <- function(remuestra, ...) {
analysis(remuestra) |>
group_by(Muestra) |>
summarise(m = mean(y27a_bin)) |>
summarise(m[1] - m[2]) |>
pull()
}
dist_perm <- remuestras |> mutate(dif_m = map(splits, dif_dos_medias)) |> unnest( dif_m)
dif_obs <- dist_perm |> filter(id == "Apparent") |> pull(dif_m)
n_extremos <- dist_perm |> filter(abs(dif_m) >= abs(dif_obs)) |> summarise (n = n ())
p_valor <- n_extremos / (R + 1)
p_valor <- p_valor$n
cat("p-value =", p_valor, "\n")
titulo <- paste("Contraste de hipótesis usando", R, "permutaciones")
y27a <- if_else(
p_valor < 0.001,
glue("italic(p) ~ '<' ~ 0.001"),
glue("italic(p) == {sprintf('%.3f', p_valor)}")
)
ancho_barra <- diff(range(dist_perm[["dif_m"]])) /
nclass.scott(dist_perm[["dif_m"]])
ancho_barra_ajustado <- abs(dif_obs) /
max(1, round(abs(dif_obs) / ancho_barra))
dist_perm_pl <- dist_perm |>
mutate(
extremo = factor(if_else(abs(dif_m) >= abs(dif_obs), 1, 0))
) |>
ggplot(aes(x = dif_m)) +
geom_histogram(
aes(alpha = extremo),
boundary = 0,
binwidth = ancho_barra_ajustado,
color = "steelblue4",
fill = "steelblue"
) +
labs(
title = titulo,
x = "Diferencia de dos medias",
y = "Frecuencia"
) +
geom_vline(
xintercept = c(-dif_obs, dif_obs),
colour = "steelblue4",
linetype = "dashed"
) +
annotate(
"text",
x = dif_obs,
y = Inf,
hjust = 1.2,
vjust = 2,
label = y27a,
parse = TRUE
) +
scale_alpha_manual(values = c("0" = 0.2, "1" = 1), guide = NULL) +
theme(plot.title = element_text(hjust = 0.5)) +
theme_pubr()
print(dist_perm_pl)
titulo <- paste("Contraste de hipótesis usando", R, "permutaciones")
y27a <- if_else(
p_valor < 0.001,
glue("italic(p) ~ '<' ~ 0.001"),
glue("italic(p) == {sprintf('%.3f', p_valor)}")
)
ancho_barra <- diff(range(dist_perm[["dif_m"]])) /
nclass.scott(dist_perm[["dif_m"]])
ancho_barra_ajustado <- abs(dif_obs) /
max(1, round(abs(dif_obs) / ancho_barra))
dist_perm_pl <- dist_perm |>
mutate(
extremo = factor(if_else(abs(dif_m) >= abs(dif_obs), 1, 0))
) |>
ggplot(aes(x = dif_m)) +
geom_histogram(
aes(alpha = extremo),
boundary = 0,
binwidth = ancho_barra_ajustado,
bins = 30,
color = "steelblue4",
fill = "steelblue"
) +
labs(
title = titulo,
x = "Diferencia de dos medias",
y = "Frecuencia"
) +
geom_vline(
xintercept = c(-dif_obs, dif_obs),
colour = "steelblue4",
linetype = "dashed"
) +
annotate(
"text",
x = dif_obs,
y = Inf,
hjust = 1.2,
vjust = 2,
label = y27a,
parse = TRUE
) +
scale_alpha_manual(values = c("0" = 0.2, "1" = 1), guide = NULL) +
theme(plot.title = element_text(hjust = 0.5)) +
theme_pubr()
print(dist_perm_pl)
titulo <- paste("Contraste de hipótesis usando", R, "permutaciones")
y27a <- if_else(
p_valor < 0.001,
glue("italic(p) ~ '<' ~ 0.001"),
glue("italic(p) == {sprintf('%.3f', p_valor)}")
)
ancho_barra <- diff(range(dist_perm[["dif_m"]])) /
nclass.scott(dist_perm[["dif_m"]])
ancho_barra_ajustado <- abs(dif_obs) /
max(1, round(abs(dif_obs) / ancho_barra))
dist_perm_pl <- dist_perm |>
mutate(
extremo = factor(if_else(abs(dif_m) >= abs(dif_obs), 1, 0))
) |>
ggplot(aes(x = dif_m)) +
geom_histogram(
aes(alpha = extremo),
#boundary = 0,
#binwidth = ancho_barra_ajustado,
bins = 30,
color = "steelblue4",
fill = "steelblue"
) +
labs(
title = titulo,
x = "Diferencia de dos medias",
y = "Frecuencia"
) +
geom_vline(
xintercept = c(-dif_obs, dif_obs),
colour = "steelblue4",
linetype = "dashed"
) +
annotate(
"text",
x = dif_obs,
y = Inf,
hjust = 1.2,
vjust = 2,
label = y27a,
parse = TRUE
) +
scale_alpha_manual(values = c("0" = 0.2, "1" = 1), guide = NULL) +
theme(plot.title = element_text(hjust = 0.5)) +
theme_pubr()
print(dist_perm_pl)
titulo <- paste("Contraste de hipótesis usando", R, "permutaciones")
y27a <- if_else(
p_valor < 0.001,
glue("italic(p) ~ '<' ~ 0.001"),
glue("italic(p) == {sprintf('%.3f', p_valor)}")
)
ancho_barra <- diff(range(dist_perm[["dif_m"]])) /
nclass.scott(dist_perm[["dif_m"]])
ancho_barra_ajustado <- abs(dif_obs) /
max(1, round(abs(dif_obs) / ancho_barra))
dist_perm_pl <- dist_perm |>
mutate(
extremo = factor(if_else(abs(dif_m) >= abs(dif_obs), 1, 0))
) |>
ggplot(aes(x = dif_m)) +
geom_histogram(
aes(alpha = extremo),
#boundary = 0,
#binwidth = ancho_barra_ajustado,
bins = 100,
color = "steelblue4",
fill = "steelblue"
) +
labs(
title = titulo,
x = "Diferencia de dos medias",
y = "Frecuencia"
) +
geom_vline(
xintercept = c(-dif_obs, dif_obs),
colour = "steelblue4",
linetype = "dashed"
) +
annotate(
"text",
x = dif_obs,
y = Inf,
hjust = 1.2,
vjust = 2,
label = y27a,
parse = TRUE
) +
scale_alpha_manual(values = c("0" = 0.2, "1" = 1), guide = NULL) +
theme(plot.title = element_text(hjust = 0.5)) +
theme_pubr()
print(dist_perm_pl)
titulo <- paste("Contraste de hipótesis usando", R, "permutaciones")
y27a <- if_else(
p_valor < 0.001,
glue("italic(p) ~ '<' ~ 0.001"),
glue("italic(p) == {sprintf('%.3f', p_valor)}")
)
ancho_barra <- diff(range(dist_perm[["dif_m"]])) /
nclass.scott(dist_perm[["dif_m"]])
ancho_barra_ajustado <- abs(dif_obs) /
max(1, round(abs(dif_obs) / ancho_barra))
dist_perm_pl <- dist_perm |>
mutate(
extremo = factor(if_else(abs(dif_m) >= abs(dif_obs), 1, 0))
) |>
ggplot(aes(x = dif_m)) +
geom_histogram(
aes(alpha = extremo),
#boundary = 0,
#binwidth = ancho_barra_ajustado,
bins = 20,
color = "steelblue4",
fill = "steelblue"
) +
labs(
title = titulo,
x = "Diferencia de dos medias",
y = "Frecuencia"
) +
geom_vline(
xintercept = c(-dif_obs, dif_obs),
colour = "steelblue4",
linetype = "dashed"
) +
annotate(
"text",
x = dif_obs,
y = Inf,
hjust = 1.2,
vjust = 2,
label = y27a,
parse = TRUE
) +
scale_alpha_manual(values = c("0" = 0.2, "1" = 1), guide = NULL) +
theme(plot.title = element_text(hjust = 0.5)) +
theme_pubr()
print(dist_perm_pl)
titulo <- paste("Contraste de hipótesis usando", R, "permutaciones")
y27a <- if_else(
p_valor < 0.001,
glue("italic(p) ~ '<' ~ 0.001"),
glue("italic(p) == {sprintf('%.3f', p_valor)}")
)
ancho_barra <- diff(range(dist_perm[["dif_m"]])) /
nclass.scott(dist_perm[["dif_m"]])
ancho_barra_ajustado <- abs(dif_obs) /
max(1, round(abs(dif_obs) / ancho_barra))
dist_perm_pl <- dist_perm |>
mutate(
extremo = factor(if_else(abs(dif_m) >= abs(dif_obs), 1, 0))
) |>
ggplot(aes(x = dif_m)) +
geom_histogram(
aes(alpha = extremo),
#boundary = 0,
#binwidth = ancho_barra_ajustado,
bins = 15,
color = "steelblue4",
fill = "steelblue"
) +
labs(
title = titulo,
x = "Diferencia de dos medias",
y = "Frecuencia"
) +
geom_vline(
xintercept = c(-dif_obs, dif_obs),
colour = "steelblue4",
linetype = "dashed"
) +
annotate(
"text",
x = dif_obs,
y = Inf,
hjust = 1.2,
vjust = 2,
label = y27a,
parse = TRUE
) +
scale_alpha_manual(values = c("0" = 0.2, "1" = 1), guide = NULL) +
theme(plot.title = element_text(hjust = 0.5)) +
theme_pubr()
print(dist_perm_pl)
titulo <- paste("Contraste de hipótesis usando", R, "permutaciones")
y27a <- if_else(
p_valor < 0.001,
glue("italic(p) ~ '<' ~ 0.001"),
glue("italic(p) == {sprintf('%.3f', p_valor)}")
)
ancho_barra <- diff(range(dist_perm[["dif_m"]])) /
nclass.scott(dist_perm[["dif_m"]])
ancho_barra_ajustado <- abs(dif_obs) /
max(1, round(abs(dif_obs) / ancho_barra))
dist_perm_pl <- dist_perm |>
mutate(
extremo = factor(if_else(abs(dif_m) >= abs(dif_obs), 1, 0))
) |>
ggplot(aes(x = dif_m)) +
geom_histogram(
aes(alpha = extremo),
#boundary = 0,
#binwidth = ancho_barra_ajustado,
bins = 19,
color = "steelblue4",
fill = "steelblue"
) +
labs(
title = titulo,
x = "Diferencia de dos medias",
y = "Frecuencia"
) +
geom_vline(
xintercept = c(-dif_obs, dif_obs),
colour = "steelblue4",
linetype = "dashed"
) +
annotate(
"text",
x = dif_obs,
y = Inf,
hjust = 1.2,
vjust = 2,
label = y27a,
parse = TRUE
) +
scale_alpha_manual(values = c("0" = 0.2, "1" = 1), guide = NULL) +
theme(plot.title = element_text(hjust = 0.5)) +
theme_pubr()
print(dist_perm_pl)
